= form_tag weekly_reports_path, method: :get, class: 'form-horizontal' do |f|
  .input-group.my-3
    = link_to '<', weekly_reports_path(date: @date.ago(1.week).to_date), class: 'btn'
    .input-group-prepend
      %span.input-group-text= icon('fas', 'calendar')
    = text_field_tag :date, @date, class: 'form-control js-datepicker'
    .input-group-append
      = submit_tag 'go', class: 'btn btn-primary'
    = link_to '>', weekly_reports_path(date: @date.since(1.week).to_date), class: 'btn'

= render 'tasks/task_list', tasks: @tasks

%table.table.table-responsive
  %thead
    %tr
      %th プロジェクト
      %th 見積
      %th 実績
  %tbody
    - @tasks.group_by {|task| task.project }.sort_by {|k, _| k.to_s }.each do |project, tasks|
      %tr
        %td= project&.name
        %td= tasks.pluck(:estimate).compact.sum
        %td= tasks.map(&:actual).compact.sum.to_i
